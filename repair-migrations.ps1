# Repair Supabase migration history
# This marks all existing migrations as already applied in the remote database

Write-Host "Repairing migration history..." -ForegroundColor Cyan
Write-Host "This will mark all local migrations as applied in the remote database" -ForegroundColor Yellow
Write-Host ""

$migrations = @(
    "20250828052813", "20250828052955", "20250828061401", "20250828063705",
    "20250828064116", "20250828071354", "20250828071417", "20250828071557",
    "20250828075121", "20250828080117", "20250828080707", "20250828082033",
    "20250828082601", "20250828083034", "20250828083817", "20250828084348",
    "20250828210948", "20250828211022", "20250828230704", "20250829000448",
    "20250829001101", "20250829001133", "20250829004143", "20250829004212",
    "20250829004610", "20250829005125", "20250829005208", "20250829005223",
    "20250829005249", "20250829005308", "20250829005725", "20250829005750",
    "20250829005812", "20250829005830", "20250829005904", "20250829010003",
    "20250829042310", "20250829185655", "20250829190202", "20250829190243",
    "20250829192649", "20250829192839", "20250829192940", "20250829192958",
    "20250829193014", "20250830021248", "20250830021912", "20250830021956",
    "20250830022025", "20250830022049", "20250830022107", "20250830022131",
    "20250830022202", "20250830022231", "20250830023447", "20250830023525",
    "20250830023554", "20250830023947", "20250830024005", "20250830024027",
    "20250830024200", "20250830033040", "20250830034950", "20250830035021",
    "20250830040743", "20250830043619", "20250830050806", "20250830050818",
    "20250830051607", "20250830234253", "20250830235042", "20250830235112",
    "20250830235150", "20250830235206", "20250830235237", "20250831001851",
    "20250831002444", "20250831002650", "20250831022551", "20250831024227",
    "20250831024407", "20250831090500", "20250831183000", "20250901000000",
    "20250905090000", "20250905090500", "20250905140000", "20250905141000",
    "20250905142000", "20250920000001", "20250920090000", "20250930093000",
    "20250930200928"
)

$total = $migrations.Count
$current = 0

foreach ($migration in $migrations) {
    $current++
    Write-Host "[$current/$total] Repairing $migration..." -ForegroundColor Gray
    
    npx supabase migration repair --status applied $migration
    
    if ($LASTEXITCODE -ne 0) {
        Write-Host "  Failed to repair $migration" -ForegroundColor Red
    }
}

Write-Host ""
Write-Host "Migration history repair complete!" -ForegroundColor Green
Write-Host ""
Write-Host "Now you can:" -ForegroundColor Cyan
Write-Host "  1. Run 'npx supabase db pull' to verify sync" -ForegroundColor White
Write-Host "  2. Run 'npx supabase db push' to push any new migrations" -ForegroundColor White
